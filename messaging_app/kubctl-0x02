#!/bin/bash

# kubctl-0x02: Blue-Green Deployment Orchestrator

echo "Deploying Blue Version..."
kubectl apply -f blue_deployment.yaml
kubectl apply -f kubeservice.yaml

echo "Deploying Green Version (Testing Phase)..."
kubectl apply -f green_deployment.yaml

echo "Waiting for Green pods to stabilize..."
sleep 10

# Get the name of a Green pod
GREEN_POD=$(kubectl get pods -l version=green -o jsonpath="{.items[0].metadata.name}")

echo "Checking logs for Green pod: $GREEN_POD"
echo "--------------------------------------------"
kubectl logs $GREEN_POD --tail=20
echo "--------------------------------------------"

echo "Review logs above. If everything looks good, update 'kubeservice.yaml'"
echo "   to version: green and run 'kubectl apply -f kubeservice.yaml'"